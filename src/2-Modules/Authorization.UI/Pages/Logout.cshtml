@page "/logout"
@using CodeBlock.DevKit.Web.Blazor.Server.Services
@using CodeBlock.DevKit.Web.CookieAuthentication
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@inject ICookieAuthenticationService CookieAuthenticationService
@inject AuthenticationStateService AuthenticationStateService
@attribute [AllowAnonymous]
@functions
{
    public async Task<IActionResult> OnGet()
    {

        if (User.Identity.IsAuthenticated)
        {
            var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);

            AuthenticationStateService.RemoveUserId(currentUserId);

            await CookieAuthenticationService.SignOutAsync();
        }

        return Redirect("/login");
    }
}